
# Detection Name: AWS SSO Device Code Phishing

description: |
  The threat described in the summarized intelligence is a phishing attack that exploits the device code authentication feature in AWS Single Sign-On (AWS SSO). This feature, which is part of the OpenID Connect (OIDC) protocol, allows users to authenticate by entering a code displayed on their device. The intelligence indicates that this feature can be abused by attackers to conduct phishing attacks and bypass security controls like multi-factor authentication (MFA) and IP allow-listing.

detection_rule: |
  (in Panther (Python)):

```python
def rule(event):
    return (
        event.get("eventSource") == "signin.amazonaws.com"
        and event.get("eventName") == "InitiateDeviceAuth"
        and event.get("userAgent") not in ["aws-cli/1.", "aws-sdk-java/1.", "aws-sdk-ruby/2.", "aws-sdk-go/1.", "aws-sdk-net/1.", "aws-sdk-php/3."]
    )

def title(event):
    return "AWS SSO Device Code Phishing Attempt"

def description(event):
    return (
        "An AWS SSO device code authentication event was detected, which could indicate a phishing attempt. "
        "Attackers may be attempting to bypass security controls like MFA by exploiting the device code feature."
    )

def severity(event):
    return "high"
```
